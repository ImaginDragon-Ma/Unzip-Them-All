# 压缩文件批量解压工具

一个基于 PyQt5 的图形化批量解压工具，支持调用 WinRAR API 解压各类压缩文件，并可递归解压多层压缩包。

## 功能特性

- ✅ **图形化界面**：简洁直观的 PyQt5 界面
- ✅ **多文件选择**：支持一次选择多个压缩文件
- ✅ **密码解压**：支持输入解压密码
- ✅ **智能识别**：通过文件头魔数自动识别压缩格式
- ✅ **自动修正扩展名**：根据文件实际类型修正文件后缀
- ✅ **WinRAR API**：调用 WinRAR 命令行进行解压
- ✅ **递归解压**：支持多层压缩包的自动解压（解压后若仍为压缩文件则继续解压）
- ✅ **实时日志**：显示详细的解压进度和日志

## 系统要求

- Windows 操作系统
- Python 3.7+
- **WinRAR**（必须安装，且已添加到系统 PATH）
- PyQt5

## 安装步骤

### 1. 安装 WinRAR

从 [WinRAR 官网](https://www.rarlab.com/download.htm) 下载并安装 WinRAR，确保 `winrar.exe` 已添加到系统 PATH 环境变量中。

### 2. 安装 Python 依赖

```bash
pip install PyQt5
```

### 3. 克隆或下载项目

```bash
git clone <repository_url>
```

## 使用方法

### 1. 启动程序

```bash
python main.py
```

### 2. 操作步骤

1. **选择文件**：点击"选择文件"按钮，选择一个或多个需要解压的压缩文件
2. **设置输出目录**（可选）：修改输出目录，默认为当前目录
3. **输入密码**（可选）：如果压缩文件有密码，在"解压密码"框中输入
4. **开始解压**：点击"开始解压"按钮
5. **查看日志**：在日志框中查看解压进度和详细信息

### 3. 支持的压缩格式

- ZIP (.zip)
- RAR (.rar, .r00, .r01, ..., .part1.rar)
- 7-Zip (.7z, .7z.001, ...)
- TAR (.tar)
- GZIP (.gz)
- 分卷压缩 (.001, .002, ...)

## 原理说明

### 文件识别与扩展名修正

程序通过读取文件头部的魔数（magic number）来识别文件的实际压缩格式，并自动修正文件扩展名：

| 文件头 | 压缩格式 | 扩展名 |
|--------|----------|--------|
| `50 4B 03 04` | ZIP | .zip |
| `52 61 72 21` | RAR | .rar |
| `37 7A BC AF` | 7-Zip | .7z |
| `1F 8B` | GZIP | .gz |

### 递归解压流程

```
压缩文件 → 解压 → 检查内容 → 是否有压缩文件？
                       ↓ 是          ↓ 否
                   递归解压         移动文件到根目录
```

### WinRAR 命令行参数

```bash
winrar x -y -o+ -inul -p<password> <file> <output_dir>
```

- `x`：完整路径解压
- `-y`：覆盖所有确认
- `-o+`：覆盖已存在文件
- `-inul`：禁用所有消息
- `-p<password>`：解压密码

## 文件说明

| 文件/目录 | 说明 |
|-----------|------|
| [main.py](main.py) | 程序入口 |
| [config/](config/) | 配置管理模块 |
| [core/](core/) | 核心解压逻辑模块 |
| [gui/](gui/) | 图形界面模块 |
| [utils/](utils/) | 工具模块 |

## 项目架构

```
Unzip-Them-All/
├── main.py                 # 程序入口
├── config/
│   ├── settings.py         # 配置管理
│   ├── constants.py        # 常量定义
│   └── i18n.py           # 国际化支持
├── core/
│   ├── extractor.py        # 核心解压逻辑
│   ├── file_analyzer.py    # 文件分析器
│   └── winrar_helper.py    # WinRAR 封装
├── gui/
│   ├── main_window.py      # 主窗口
│   ├── task_widget.py     # 任务组件
│   ├── worker_thread.py    # 工作线程
│   ├── app_icon.py        # 应用图标
│   └── __init__.py       # GUI模块入口
└── utils/                  # 工具模块
```

### 模块职责

| 模块 | 职责 |
|------|------|
| `config` | 配置加载、保存，常量定义 |
| `core.extractor` | 解压核心逻辑，可独立测试 |
| `core.file_analyzer` | 文件类型识别、扩展名修正 |
| `core.winrar_helper` | WinRAR 命令行工具封装 |
| `gui.main_window` | 主窗口 UI 组件 |
| `gui.task_widget` | 单个任务的 UI 组件 |
| `gui.worker_thread` | 后台工作线程 |

## Git 提交历史

```bash
git log --oneline
```

每次代码修改都会进行一次提交，提交信息清晰描述了修改内容。

## 常见问题

### Q: 提示"未找到 WinRAR"？

A: 请确认已安装 WinRAR 并将其添加到系统 PATH 环境变量中。

### Q: 解压失败怎么办？

A: 检查日志框中的错误信息，常见原因：
- 文件损坏
- 密码错误
- 权限不足

### Q: 如何停止解压？

A: 当前版本暂不支持中途停止，可以在任务管理器中结束进程。

## 开发说明

### 代码结构

```
main.py
├── ExtractorGUI         # 主窗口界面
├── TaskWidget          # 任务组件
└── ExtractWorker       # 解压工作线程（后台执行）
```

## 许可证

本项目仅供学习和个人使用。

## 作者

由 Claude (Anthropic) 协助开发

## 更新日志

### 2026-02-15
- 添加任务状态指示器
- 添加应用程序图标
- 支持多任务独立配置（不同输出路径、不同密码）
- 添加密码管理功能
- 添加多语言支持（中文/英文）

### 2026-02-14
- 初始版本发布
- 实现基础图形化界面
- 支持多文件选择和密码输入
- 实现智能识别和扩展名修正
- 支持递归解压多层压缩文件
